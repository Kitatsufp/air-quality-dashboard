<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
</head>

<body>

    <div id="chart" style="width:100%;height:500px;"></div>

    <script>
        let chart = echarts.init(document.getElementById('chart'));

        let data = [];
        let maxPoints = 50;
        let isAutoFollow = true;

        // ===== ADD DATA =====
        function addData(value) {
            let now = new Date();
            let time =
                now.getHours() + ":" +
                now.getMinutes().toString().padStart(2, '0') + ":" +
                now.getSeconds().toString().padStart(2, '0');

            data.push({
                name: time,
                value: [time, value]
            });

            if (data.length > 200) {
                data.shift();
            }
        }

        // ===== OPTION =====
        let option = {
            animation: false,

            tooltip: {
                trigger: 'axis'
            },

            legend: {
                data: ['Air Quality']
            },

            xAxis: {
                type: 'category',
                boundaryGap: false
            },

            yAxis: {
                type: 'value',
                min: 0,
                max: 500,
                scale: false
            },

            dataZoom: [
                {
                    type: 'slider',
                    show: true,
                    xAxisIndex: 0,
                    filterMode: 'none'
                },
                {
                    type: 'inside',
                    xAxisIndex: 0,
                    filterMode: 'none'
                }
            ],

            series: [
                {
                    name: 'Air Quality',
                    type: 'line',
                    smooth: true,
                    showSymbol: true,
                    data: data
                }
            ]
        };

        chart.setOption(option);

        // ===== LISTEN ZOOM EVENT =====
        chart.on('dataZoom', function (params) {
            let zoom = chart.getOption().dataZoom[0];

            // Nếu đang không ở cuối → tắt auto follow
            if (zoom.end < 99) {
                isAutoFollow = false;
            } else {
                isAutoFollow = true;
            }
        });

        // ===== REALTIME UPDATE =====
        setInterval(() => {

            let randomValue = Math.round(Math.random() * 400 + 50);
            addData(randomValue);

            if (isAutoFollow) {
                chart.setOption({
                    dataZoom: [{
                        startValue: Math.max(data.length - maxPoints, 0),
                        endValue: data.length - 1
                    }],
                    series: [{
                        data: data
                    }]
                });
            } else {
                chart.setOption({
                    series: [{
                        data: data
                    }]
                });
            }

        }, 2000);

    </script>

</body>

</html>